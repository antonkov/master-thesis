\message{ !name(VoltageAnal.tex)}% !TEX encoding = cp1251
\documentclass{article}

\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[russian]{babel}
\usepackage{etoolbox}
\usepackage{epsfig,amssymb,amsmath}
\usepackage{array}
%%%%% drawings
\usepackage{tikz}
\newcommand{\inputTikZ}[1]{\input{#1.tikz}}


\newtheorem{theorem}{Теорема}[section]
\newtheorem{lemma}[theorem]{Лемма}
\newtheorem{corollary}[theorem]{Следствие}
\newtheorem{example}{Пример}[section]
\newtheorem{prop}{Свойство}[section]
\newtheorem{definition}{Определение}[section]


\newcommand{\bs}[1]{\ensuremath{\boldsymbol{#1}}}


\begin{document}

\message{ !name(VoltageAnal.tex) !offset(-3) }


\title {Вычисление спектра циклов графа}
\maketitle

\section{Ведение}

Интуиция подсказывает, что большой обхват и 
малое число коротких циклов положительно сказываются на эффективности 
итеративного декодирования.

Существуют и другие критерии для поиска хороших МППЧ кодов, например, ACE. 
В любом случае, все сводится к анализу струтуры циклов графа. 
Поиск кодов, обладающих хорошей  структурой -- вычислительно сложная задача.
Наша задача - упростить вычисления. 

Известные подходы ....

Новый подход имеет простое описание и низкую вычислительную сложность


\section{Алгоритм подсчета спектров}
Эта задача порождена проблемой анализа и оптимизации МППЧ кодов. 
Пусть $B$  -- (двоичная) базовая матрица кода.
Для нее определен двудольный граф Таннера $T=\{V, E \}$ с множеством вершин 
$V= V_s \cup V_c$, где  $V_s$ и  $V_c$ -- множества символьных и проверочных вершин, 
соответственно. Единицам  матрицы $B$ соответствуют ребра графа $T$. 


\begin{example} \label{ex1}
Рассмотрим  базовую матрицу $B$ 
\begin{eqnarray}%{C} %\label{H0}
B(D)&=&
\begin{pmatrix}
1&1&0&   1\\
1&1&1& 0\\
1&0         & 1& 1
\end{pmatrix},       
\end{eqnarray}
для задающей квазициклический МППЧ код полиномиальной проверочной матрицы 
\begin{eqnarray}%{C} %\label{H0}
H(D)&=&
\begin{pmatrix}
D^{w_{11}}&D^{w_{12}}&0&   D^{w_{14}}\\
D^{w_{21}}&D^{w_{22}}& D^{w_{23}}& 0\\
D^{w_{31}}&0         &  D^{w_{33}}& D^{w_{34}}
\end{pmatrix}                          \label{H0}                                                                                                                  
\end{eqnarray}
Для удобства переназначим веса переходов
\begin{equation} \label{H}
H(D)=
\begin{pmatrix}
D^{w_{1}}&D^{w_{4}}&0                   &   D^{w_{8}}\\
D^{w_{2}}&D^{w_{5}}& D^{w_{6}}& 0\\
D^{w_{3}}&0                &  D^{w_{7}}& D^{w_{9}}
\end{pmatrix}                                                                                                                                           
\end{equation}
Соответствующая матрица инцидентности графа Таннера 
\[
\arraycolsep=1.5pt \def\arraystretch{1}
T(D)=
\begin{pmatrix}
1   &        1 &  1& 0 &0 & 0 &   0 &  0 &  0 \\
0   &        0 &  0& 1 &1 & 0 &   0 &  0 &  0 \\
0   &        0 &  0& 0&0 & 1 &   1 &  0 &  0 \\
0   &        0 &  0& 0 &0 & 0 &   0 &  1 &  1 \\
D^{w_{1}}&   0   &  0  & D^{w_{4}}&0 &  0 & 0                   &   D^{w_{8}} & 0\\
0          &D^{w_{2}} &0  &0&D^{w_{5}}&  D^{w_{6}}          & 0          & 0&0\\
0 & 0& D^{w_{3}}      &0         &0      &  0   &  D^{w_{7}}& 0 &D^{w_{9}}
\end{pmatrix}                                                                                                                                           
\]
Сам граф показан на рис. \ref{fig1}. 
Кружками и квадратами показаны символьные и проверочные узлы. 
\begin{figure}[!h]
  \centering
  \inputTikZ{ex_graph}
   \caption{Граф Таннера для кода из примера \ref{ex1}}
  \label{fig1}
\end{figure}

\end{example}

Задача состоит в подсчете числа циклов заданной длины в расширенном 
графе с заданной степенью расширения $M$. Длина цикла равна числу переходов в 
пути, начинающемся и заканчивающемся  в одном и том же узле и таком, что 
сумма весов переходов по модулю $M$ равна нулю. 
Веса суммируются с учетом знаков, зависящих от направления 
перехода (см. рис. \ref{fig1}).

Такой тип циклов часто нызывают замкнутым обходом, однако при подсчете
рассматриваемых объектов необходимо учесть следующие дополнительные ограничения.
\begin{itemize}
\item
Запрещено двигаться обратно по последнему пройденному ребру. Например,
путь  6$\to$1$\to$6 веса 0 запрещен.
\item
Циклические сдвиги путей и инверсии путей должны  учитываться как один цикл. Например, путь
$p=6\to 1 \to 7\to 3 \to 6$  образует цикл при условии $w_2-w_6+w_7-w_3=0$. При этом пути
$6 \to 3 \to 7\to 1 \to 6$ и  $1\to 7 \to 3\to 6 \to 1$ тоже циклы, но они уже не вносят
вклад в число циклов длины 4,
если цикл $p$ учтен. 
\end{itemize}

Хотелось бы применить стандартные методы, используемые при анализе систем на основе 
конечных автоматов. Данный граф не является конечным автоматом, поскольку перемещение
из состояния в состояние зависит от предыдущего состояния.  Например, на рис. \ref{fig1}
после состояния 4 возможно только 5, если предыдущим было 7 и, наоборот,
только 7, если предыдущим было 5. 

Чтобы свести задачу к анализу конечных автоматов, введем новое множество состояний 
$U=\{e,\xi\}$, где  $e$ задает ребро исходного графа, а $\xi$ -- направление перехода. 
Сокращенно будем записывать пары в виде $+e$  и $-e$.   
 
Из графа на рис. \ref{fig1} получится  граф с 18 состояниями $\{ \pm 1, \pm 2,..., \pm 9\}$.
Заметим, однако, что после отрицательного  ребра следуют только положительные и после 
положительного отрицательные. Это позволит записать матрицу переходов компактно 
в виде двух матриц, матрицы положительных и матрицы отрицательных переходов.
Например, следующими состояниями (ребрами графа Таннера) после положительного перехода 
$+1$  возможны отрицательные $-4, -8$. После отрицательного перехода
$-1$  возможны положительные $2,3$. 

В нашем примере две матрицы переходов  имеют вид
 \[
 \setlength{\arraycolsep}{2.pt}
A_{-}=
\begin{pmatrix}
  0           &0          & 0     &D^{-w_4}& 0              & 0&0 & D^{-w_8}&0 \\
   0          & 0        & 0     & 0    &D^{-w_5}&D^{-w_6}&   0 &    0 &  0  \\ 
    0         &  0       &  0    & 0    &   0  &   0  &D^{-w_7}&   0  &D^{-w_9}\\ 
D^{-w_1}&  0       &    0  &   0  &   0  &   0  & 0   &D^{-w_8}&  0  \\ 
  0          &D^{-w_2}&  0    & 0    &  0   &D^{-w_6}&  0  & 0    &0    \\ 
   0         &D^{-w_2}&   0   &  0   & D^{-w_5}&   0  &  0  &  0   & 0   \\ 
   0         &0         &D^{-w_3}& 0    &  0   &   0  &0    &0     &D^{-w_9} \\ 
D^{-w_1}&0         &   0   &D^{-w_4}&  0   & 0    & 0   &   0  &0    \\ 
   0        & 0        &D^{-w_3} &   0  &    0 &  0   &D^{-w_7}    & 0    &0     
               \end{pmatrix}
\]
\[
A_{-}=
\begin{pmatrix}
0              &D^{w_2}&D^{w_3}&  0  &      0         & 0&0 &0 &0 \\
D^{w_1}& 0              &D^{w_3}&0    &      0         &0 &0 &0 &0 \\
D^{w_1}&D^{w_2}&0               & 0   &       0        &0 &0 &0 &0 \\
0              & 0             &0                &0    &D^{w_5}&0 &0 & 0& 0 \\
 0             &  0            &0                & D^{w_4}& 0 &0 &0  &0 & 0 \\
  0            &   0           & 0               &  0& 0 & 0&D^{w_7}  &0 &0  \\
   0           &    0          &  0              & 0 & 0 &D^{w_6}&0  &0 &0  \\
    0          &      0        &   0             & 0 & 0 & 0& 0& 0&  D^{w_9} \\
     0         &     0         &    0            & 0 & 0&0 & 0&  D^{w_8} &0
\end{pmatrix}
\]

Заметим, что все циклы имеют четную длину и состоят из пар переходов
(по стрелке, против стрелки). Можно построить матрицу переходов за
два шага, как произведение матриц $A_+, A_-$
\[
A=A_+A_{-}=\begin{pmatrix}
     0    & 0 &    0 &    0 &    \omega_{45}   &  0 &    0 &    0 &    \omega_{89}\\
     0&     0&     0&     \omega_{54} &    0  &   0  &   \omega_{67}  &   0  &   0 \\
     0&     0&     0&     0&     0&     \omega_{76} &     0&      \omega_{98}   &   0\\
     0&     \omega_{12}      & \omega_{13}  &    0 &    0  &   0 &    0  &   0      & \omega_{89} \\
\omega_{21}     &0     & \omega_{23}     &0   &0   &0     & \omega_{67}     &0 &   0\\
\omega_{21}     &0     & \omega_{23}      & \omega_{54}    &0   &0   &0   &0   & 0\\
\omega_{31}     & \omega_{32}  &0    &0   &0   &0   &0     & \omega_{98}     & 0\\
    0     & \omega_{12}      & \omega_{13}     &0    & \omega_{45}     &0   &0   &0   & 0\\
\omega_{31}      & \omega_{32}     &0   &0   &0     & \omega_{76}     &0   &0   & 0\\
\end{pmatrix}
\]
где
$\omega_{ij}=D^{-w_i+w_j}$.
%
%     0     0     0     0     1     0     0     0     1
%     0     0     0     1     0     0     1     0     0
%     0     0     0     0     0     1     0     1     0
%     0     1     1     0     0     0     0     0     1
%     1     0     1     0     0     0     1     0     0
%     1     0     1     1     0     0     0     0     0
%     1     1     0     0     0     0     0     1     0
%     0     1     1     0     1     0     0     0     0
%     1     1     0     0     0     1     0     0     0

В общем случае матрица переходов за 2 шага будет иметь размер, равный числу единиц в 
базовой матрице $B$. 

Для подсчета производящей функции числа путей длины $2L$, начинающихся с ребра 1 в положительном направлении
нужно начальный вектор $a_0=(1,0,...,0)$ умножить на $A^L$. Для нашего примера при
 \begin{equation}
\bs a_2=\bs a_0 A =
\begin{pmatrix}
     0    & 0 &    0 &    0 &    \omega_{45}   &  0 &    0 &    0 &    \omega_{89}
 \end{pmatrix}
\end{equation} 
\begin{equation}\label{eq4}
 \bs a_4=\bs a_2A=
 \begin{pmatrix}    
    \omega_{4521,8931}  &\omega_{8932} & \omega_{4523 } &0 &    0 &    \omega_{8976}   & \omega_{4567 }&    0 &    0 
 \end{pmatrix}
\end{equation} 
где первая компонента является сокращенной записью полинома
\[
 \omega_{4521,8931}=D^{-w_4+w_5-w_2+w_1}+D^{-w_8+w_9-w_3+w_1}
\]
Кроме того необходимо отметить:
\begin{itemize}
\item 
Соблюдение условия неповторения ребра на стыке цикла также соблюдается.
\item
Хотя мы пишем $+, -$  в выражениях типа $D^{-w_4+w_5-w_2+w_1}$,
$w_i$ не коммутируют между собой так как неупорядоченный набор ребер не задает однозначно цикл (\ref{ex2}),
 таким образом до подстановки конкретных значений $w_i$ не могут быть сложены.
\end{itemize}

\begin{figure}[!h]
  \centering
  \inputTikZ{ex_graph2}
   \caption{Граф Таннера для кода из примеров \ref{ex2}, \ref{ex3}}
  \label{fig1}
\end{figure}

\begin{example} \label{ex2}
  Обозначим пути $c_1=1 \to -4 \to 5 \to -2$, $c_2=1 \to -4 \to 6 \to -3$, $c_3=2 \to -5 \to 6 \to -3$.
 Обратные к этим путям по направлению соответственно $c_{-1}, c_{-2}, c_{-3}$.
 Тогда набор ребер как объеденением $\{c_1,c_{-2},c_{-3}\}$ может обозначать два пути -- $c_1c_{-3}c_{-2}$ и 
$c_1c_{-2}c_{-3}$, которые не могут быть получены друг из друга с помощью циклического сдвига и инверсии.
\end{example}

Из (\ref{eq4}) видим, что существуют 2 потенциальных цикла длины 4. 
Цикл образуется в том случае, когда сумма в показателе степени равна нулю. 
Например, если $-w_4+w_5-w_2+w_1=0$, а  $-w_8+w_9-w_3+w_1\neq 0$  то 
\[
a_{41}(D)=1+D^{-w_8+w_9-w_3+w_1}, 
\]
и $a_{41}(0)=1$.
Пусть $a_{2L,i}^{j}$ -- обозначет коэффициент при $D^j$ в $i$-ой компоненете $a_{2L}$.

(здесь и далее считаем, что $D^0=1$, несмотря на то что $D$ может быть $0$. Таким образом
свободный член полинома равен количеству циклов веса $0$ без учета эквивалентных циклов)
В общем случае все циклы длины $2L$, проходящие через ребро +1 учтены в $a_{2L,1}(0)$, однако
некоторые из них могут быть учтены многократно (\ref{ex3}). Кроме того необходимо аналогично учесть
циклы, проходящие через ребро +2, +3 и так далее. Такое суммарное рассмотрение неизбежно
будет учитывать циклы повторно, однако количество повторений не обязательно равно длине цикла и
зависит от его состава.
\begin{example} \label{ex3}

 Пути $1 \to -4 \to 5 \to -2 \to 1 \to -4 \to 6 \to -3$ и $1 \to -4 \to 6 \to -3 \to 1 \to -4 \to 5 \to -2$,
начинающийеся с $1$ эквивалентны, так как являются циклическим сдвигом друг друга, но будут учтены дважды. 
\end{example}

Дальнейшие рассуждения можно проводить двумя способами:
\begin{itemize}
  \item
  Рассматривать $w_i$ в качестве символьных переменных. 
Можно выписать все возможные комбинации весов, приводящие к потенциальным 
циклам длины $2L$ и затем вычислять спектры циклов, подставляя разные 
наборы разметок в полученные уравнения. Число циклов равно числу нулей в уравнениях.  
\item
  При заданных (фиксированных) весах ребер подсчитать спектр длин циклов в заданном диапазоне.
\end{itemize}

\subsection{Веса как символьные переменные}
В случае рассмотрения $w_i$ как символьных переменных необходимо избавиться от эквивалентных
относительно сдвига и инверсии комбинаций. Для этого каждый путь приводится к минимальному 
лексикографическому виду после чего убираются дубликаты. 

Заметим, что цикл в обратном направлении
к рассматриваемому циклу не может быть эквивалентет относительно сдвига исходному.
Обозначим $\bar{p}$ путь в обратном направлении к пути $p=e_1,e_2,...,e_n$. 
Предположим $p$ и $\bar{p}$ эквивалентны относительно сдвига -- тогда найдется индекс $i$, такой что
$\bar{e}_i, \bar{e}_{i-1}, ..., \bar{e}_1 = e_1, e_2, ..., e_i$.  Если $i$ нечетно, тогда $\bar{e}_{(i + 1)/2} = e_{(i+1)/2}$ -- противоречие.
 Если $i$ четно, то $e_{i/2 + 1}=\bar{e}_{i/2}$, что противоречит ограничению что путь не может
идти обратно по последнему пройденному ребру.

Таким образом каждому циклу соответствует ровно два пути в разных направлениях. Непосредственно
инвертируя каждый путь несложно оставить ровно один из каждой пары.

По причине того, что число различных путей растет
экспоненциально при построении всех возможных символьных комбинаций, лучше воспользоваться подходом
meet-in-the-middle. Это позволяет для нахождения всех возможных циклов длины $2L$ рассматривать
только пути длины $L$, в то время как описанный алгоритм рассмотривает пути длины $2L$.

\subsection{Фиксированные веса}
В случае когда веса изначально зафиксированы можно считать, что веса коммутируют, поэтому достаточно
считать не более $M$ членов в каждом полиноме при умножении на матрицу $A$,
 по одному значению для каждой возможной суммы весов. После чего устранить дубликаты из результата с 
помощью обращения Мебиуса.

Рассмотрим для цикла $p$ сколько раз он был учтен. Порядком цикла назовем максимальное $r$, такое что
$p$ можно представить как 
\[
p=\underbrace{ss \ldots s}_{r \text{ раз}}
\]
Периодом цикла $p$ назовем длину $|s|=\frac{|p|}{r}$. Таким образом цикл $p$ 
периода $l$ имеет $l$ различных циклических сдвигов -- следовательно будет учтен $2l$ раз, с учетом
последовательностей в обратном порядке.

Последовательно для каждого $i$ зафиксируем
\[
a_0=(\underbrace{0,0,...,0}_{i \text{ раз}},1,0,...,0)
\]
и вычислим
\[
a_{2L}=a_0A^L
\]

Запомним количество циклов (всех возможных весов) проходящих через +i, содержащееся в 
компоненте $a_{2L,i}$ как $b_{2L,i}$.

Суммируя по всем возможным $a_0$ получаем 
\[
b_{2L}=\sum_{\substack{i}}b_{2L,i}
\]
 - количество циклов длины $2L$, где каждый цикл учтен дважды столько, сколько
он имеет различных циклических сдвигов (в обоих направлениях).  

Обозначим за $g_{w}(l)$ -- число циклов длины и периода $l$ веса $w$.

При фиксированном $W$ и длине $L$ имеем равенство:
\[
  \sum_{\substack{d | L}}\sum_{\substack{w \\ w \cdot d = W \pmod M}}2d g_{w}(d) = b_L^W
\]

Равенство справедливо, так как каждый цикл длины $L$ периода $d$ веса $W$ состоит из повторенного $\frac{L}{d}$ раз
цикла длины и периода $d$ веса $w$, такого что $w\cdot d = W \pmod M$ и однозначно им задается.
Каждый такой цикл имеет $d$ различных циклических сдвигов, поэтому учтен в $b_L^W$ $2d$ раз, для обоих
направлений.

В равенствах вида
\[
  f(n)=\sum_{\substack{d|n}}g(d)
\]

$g(d)$ может быть выражено с помощью формулы обращения Мебиуса:
\[
  g(n) = \sum_{\substack{d|n}}\mu(d)f(n/d)
\]

где
\[
  \mu(n)=
\left\{
  \begin{array}{lll}
    1 & \mbox{при } n=1, \\
    0 & \mbox{если } n=2, \\
    (-1)^r & \mbox{если } n=3.
  \end{array}
\right.
\]

Зафиксируем $W$. Пусть
\[
g(d)=\sum_{\substack{w \\ w \cdot d = W \pmod M}}2d g_{w}(d)
\]
\[
  f(L)=b_L^W
\]

Тогда
\[
 \sum_{\substack{w \\ w \cdot L = W \pmod M}}2L g_{w}(L)  = \sum_{\substack{d|L}}\mu(d)b_{L/d}^W
\]


 Оценка сложности. Пусть исходная базовая  матрица имела размер $b \times c$.
Для простоты будем рассматривать $(J,K)$-регулярный МППЧ код с 
весом столбцов и строк $J$ и $K$ соответственно. 

Тогда...


\section{Численный анализ влияния спектров циклов на вероятность ошибки 
БП-декодирования} 

- описание ансамблей кодов

- описание эксперимента

- несколько (4-6) графиков из Матлаба или  TikZ

- выводы по графикам














   









   



\end{document}
\message{ !name(VoltageAnal.tex) !offset(-437) }
